# 第8章：常見應用場景庫

本章提供 10+ 個實用的 Make Bridge 應用場景，每個場景都包含完整的實作範例、最佳實踐和可重複使用的程式碼片段。這些場景涵蓋了不同行業和業務需求，可作為您開發自己的自動化解決方案的參考。

## 8.1 場景概覽

### 📋 應用場景分類

| 場景類別 | 使用案例 | 複雜度 | 適用對象 |
|---------|----------|--------|----------|
| **客戶管理** | 客戶回饋、滿意度調查、客戶分群 | 🟢 初級 | 中小企業、服務業 |
| **銷售自動化** | 潛在客戶管理、報價流程、訂單處理 | 🟡 中級 | 銷售團隊、電商 |
| **行銷活動** | 郵件行銷、社群媒體、內容發布 | 🟡 中級 | 行銷部門、媒體公司 |
| **人力資源** | 招聘流程、員工入職、考勤管理 | 🟡 中級 | HR 部門、企業管理 |
| **財務管理** | 發票處理、費用報銷、財務報告 | 🔴 高級 | 財務部門、會計師事務所 |
| **營運管理** | 庫存管理、供應鏈、品質控制 | 🔴 高級 | 製造業、零售業 |

### 🎯 實作特色

每個場景包含：
- **業務需求分析**：詳細的使用案例說明
- **Make Bridge 模板設計**：完整的工作流程配置
- **前端整合範例**：用戶介面實作
- **後端 API 整合**：伺服器端邏輯
- **測試和部署指南**：完整的上線流程
- **擴展建議**：進階功能和優化方向

## 8.2 場景 1：智能客服票據系統

### 📝 業務需求

建立一個智能客服票據系統，當客戶提交支援請求時：
1. 自動分類問題類型和優先級
2. 分配給適當的客服人員
3. 發送確認郵件給客戶
4. 創建內部通知和追蹤記錄
5. 根據回應時間自動升級

### 🔄 Make Bridge 模板設計

```javascript
// 客服票據工作流程結構
{
  "name": "智能客服票據處理",
  "description": "自動處理客戶支援請求，分類並分配給適當的客服人員",
  "modules": [
    {
      "type": "webhook",
      "name": "接收支援請求",
      "config": {
        "expectedData": {
          "customerName": "string",
          "customerEmail": "string", 
          "subject": "string",
          "description": "string",
          "priority": "low|medium|high|urgent",
          "category": "technical|billing|general|complaint",
          "attachments": "array"
        }
      }
    },
    {
      "type": "data-transformer",
      "name": "智能分類",
      "config": {
        "transformations": [
          {
            "field": "autoCategory",
            "logic": "analyzeKeywords({{description}}, {{subject}})"
          },
          {
            "field": "autoPriority", 
            "logic": "calculatePriority({{category}}, {{keywords}})"
          },
          {
            "field": "ticketId",
            "logic": "generateTicketId()"
          },
          {
            "field": "assignedAgent",
            "logic": "selectAgent({{autoCategory}}, {{autoPriority}})"
          }
        ]
      }
    },
    {
      "type": "router",
      "name": "優先級路由",
      "routes": [
        {
          "condition": "{{autoPriority}} == 'urgent'",
          "path": "urgent_handling"
        },
        {
          "condition": "{{autoPriority}} == 'high'", 
          "path": "high_priority"
        },
        {
          "condition": "true",
          "path": "standard_process"
        }
      ]
    },
    {
      "type": "airtable",
      "name": "創建票據記錄",
      "config": {
        "operation": "create",
        "table": "Support Tickets",
        "fields": {
          "Ticket ID": "{{ticketId}}",
          "Customer Name": "{{customerName}}",
          "Customer Email": "{{customerEmail}}",
          "Subject": "{{subject}}",
          "Description": "{{description}}",
          "Category": "{{autoCategory}}",
          "Priority": "{{autoPriority}}",
          "Assigned Agent": "{{assignedAgent}}",
          "Status": "Open",
          "Created At": "{{timestamp}}"
        }
      }
    },
    {
      "type": "gmail",
      "name": "發送確認郵件",
      "config": {
        "to": "{{customerEmail}}",
        "subject": "支援請求已收到 - 票據編號: {{ticketId}}",
        "template": "customer_confirmation"
      }
    },
    {
      "type": "slack",
      "name": "通知客服團隊",
      "config": {
        "channel": "#customer-support",
        "message": {
          "blocks": [
            {
              "type": "section",
              "text": {
                "type": "mrkdwn",
                "text": `:ticket: *新的支援請求* \n*票據 ID:* {{ticketId}}\n*客戶:* {{customerName}}\n*類別:* {{autoCategory}}\n*優先級:* {{autoPriority}}\n*分配給:* {{assignedAgent}}`
              }
            },
            {
              "type": "actions",
              "elements": [
                {
                  "type": "button",
                  "text": {
                    "type": "plain_text",
                    "text": "查看詳情"
                  },
                  "url": "{{ticketUrl}}"
                }
              ]
            }
          ]
        }
      }
    }
  ]
}
```

### 💻 前端整合實作

```html
<!-- support-form.html - 客服表單頁面 -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客戶支援</title>
    <link rel="stylesheet" href="support-form.css">
</head>
<body>
    <div class="support-container">
        <header class="support-header">
            <h1>🎧 客戶支援</h1>
            <p>我們很樂意協助您解決問題</p>
        </header>

        <form id="support-form" class="support-form">
            <!-- 客戶資訊 -->
            <div class="form-section">
                <h2>聯絡資訊</h2>
                
                <div class="form-group">
                    <label for="customerName">姓名 *</label>
                    <input type="text" id="customerName" name="customerName" required>
                </div>

                <div class="form-group">
                    <label for="customerEmail">電子郵件 *</label>
                    <input type="email" id="customerEmail" name="customerEmail" required>
                </div>
            </div>

            <!-- 問題詳情 -->
            <div class="form-section">
                <h2>問題詳情</h2>
                
                <div class="form-group">
                    <label for="category">問題類別 *</label>
                    <select id="category" name="category" required>
                        <option value="">請選擇...</option>
                        <option value="technical">技術問題</option>
                        <option value="billing">帳務問題</option>
                        <option value="general">一般詢問</option>
                        <option value="complaint">投訴建議</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="priority">緊急程度 *</label>
                    <select id="priority" name="priority" required>
                        <option value="">請選擇...</option>
                        <option value="low">低 - 一般詢問</option>
                        <option value="medium">中 - 需要協助</option>
                        <option value="high">高 - 影響使用</option>
                        <option value="urgent">緊急 - 系統無法使用</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subject">問題標題 *</label>
                    <input type="text" id="subject" name="subject" 
                           placeholder="簡要描述您的問題" required>
                </div>

                <div class="form-group">
                    <label for="description">詳細描述 *</label>
                    <textarea id="description" name="description" rows="6"
                              placeholder="請詳細描述您遇到的問題，包括錯誤訊息、操作步驟等" required></textarea>
                </div>

                <div class="form-group">
                    <label for="attachments">附件 (選填)</label>
                    <input type="file" id="attachments" name="attachments" 
                           multiple accept=".jpg,.jpeg,.png,.gif,.pdf,.doc,.docx">
                    <small>支援格式：圖片、PDF、Word 文件，最大 10MB</small>
                </div>
            </div>

            <!-- 提交按鈕 -->
            <div class="form-actions">
                <button type="submit" id="submit-btn" class="btn-primary">
                    <span class="btn-text">提交支援請求</span>
                    <span class="btn-loading" style="display: none;">提交中...</span>
                </button>
            </div>
        </form>

        <!-- 成功訊息 -->
        <div id="success-message" class="success-message" style="display: none;">
            <div class="success-icon">✅</div>
            <h2>支援請求已提交</h2>
            <p>您的票據編號：<strong id="ticket-id"></strong></p>
            <p>我們會在 <span id="response-time"></span> 內回覆您</p>
            <button onclick="resetForm()" class="btn-secondary">提交新的請求</button>
        </div>

        <!-- 錯誤訊息 -->
        <div id="error-message" class="error-message" style="display: none;">
            <div class="error-icon">❌</div>
            <h2>提交失敗</h2>
            <p id="error-text"></p>
            <button onclick="hideError()" class="btn-secondary">重試</button>
        </div>
    </div>

    <script src="support-form.js"></script>
</body>
</html>
```

```javascript
// support-form.js - 客服表單邏輯
class SupportFormHandler {
    constructor() {
        this.form = document.getElementById('support-form');
        this.submitBtn = document.getElementById('submit-btn');
        this.isSubmitting = false;
        
        this.setupEventListeners();
        this.setupFormValidation();
    }

    setupEventListeners() {
        this.form.addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleSubmit();
        });

        // 自動分類建議
        document.getElementById('description').addEventListener('input', 
            this.debounce(() => this.suggestCategory(), 500)
        );

        // 優先級自動調整
        document.getElementById('category').addEventListener('change', 
            () => this.adjustPriority()
        );
    }

    async handleSubmit() {
        if (this.isSubmitting) return;

        try {
            const formData = this.collectFormData();
            
            if (!this.validateForm(formData)) {
                return;
            }

            this.setSubmittingState(true);
            
            const result = await this.submitSupportRequest(formData);
            
            this.showSuccess(result);
            
        } catch (error) {
            console.error('提交支援請求失敗:', error);
            this.showError(error.message);
        } finally {
            this.setSubmittingState(false);
        }
    }

    collectFormData() {
        const formData = new FormData(this.form);
        const data = {};
        
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }

        // 處理附件
        const attachments = document.getElementById('attachments').files;
        if (attachments.length > 0) {
            data.attachments = Array.from(attachments).map(file => ({
                name: file.name,
                size: file.size,
                type: file.type
            }));
        }

        // 添加元數據
        data.timestamp = new Date().toISOString();
        data.userAgent = navigator.userAgent;
        data.url = window.location.href;

        return data;
    }

    async submitSupportRequest(formData) {
        // 如果有附件，先上傳
        if (formData.attachments && formData.attachments.length > 0) {
            const uploadedFiles = await this.uploadAttachments();
            formData.attachmentUrls = uploadedFiles;
        }

        const response = await fetch('/api/support/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
        }

        return response.json();
    }

    async uploadAttachments() {
        const files = document.getElementById('attachments').files;
        const uploadPromises = [];

        for (let file of files) {
            const formData = new FormData();
            formData.append('file', file);
            
            const uploadPromise = fetch('/api/support/upload', {
                method: 'POST',
                body: formData
            }).then(response => response.json());
            
            uploadPromises.push(uploadPromise);
        }

        return Promise.all(uploadPromises);
    }

    validateForm(data) {
        const errors = [];

        if (!data.customerName?.trim()) {
            errors.push('請輸入姓名');
        }

        if (!data.customerEmail?.trim()) {
            errors.push('請輸入電子郵件');
        } else if (!this.isValidEmail(data.customerEmail)) {
            errors.push('請輸入有效的電子郵件地址');
        }

        if (!data.category) {
            errors.push('請選擇問題類別');
        }

        if (!data.priority) {
            errors.push('請選擇緊急程度');
        }

        if (!data.subject?.trim()) {
            errors.push('請輸入問題標題');
        }

        if (!data.description?.trim()) {
            errors.push('請詳細描述問題');
        } else if (data.description.trim().length < 10) {
            errors.push('問題描述至少需要 10 個字元');
        }

        if (errors.length > 0) {
            this.showValidationErrors(errors);
            return false;
        }

        return true;
    }

    suggestCategory() {
        const description = document.getElementById('description').value.toLowerCase();
        const categorySelect = document.getElementById('category');
        
        if (!categorySelect.value && description.length > 20) {
            let suggestedCategory = 'general';
            
            if (description.includes('錯誤') || description.includes('bug') || 
                description.includes('無法') || description.includes('當機')) {
                suggestedCategory = 'technical';
            } else if (description.includes('帳單') || description.includes('付款') || 
                       description.includes('費用')) {
                suggestedCategory = 'billing';
            } else if (description.includes('不滿') || description.includes('投訴') || 
                       description.includes('抱怨')) {
                suggestedCategory = 'complaint';
            }
            
            if (suggestedCategory !== 'general') {
                categorySelect.value = suggestedCategory;
                this.highlightSuggestion(categorySelect);
            }
        }
    }

    adjustPriority() {
        const category = document.getElementById('category').value;
        const prioritySelect = document.getElementById('priority');
        
        if (!prioritySelect.value) {
            let suggestedPriority = 'medium';
            
            switch (category) {
                case 'technical':
                    suggestedPriority = 'high';
                    break;
                case 'billing':
                    suggestedPriority = 'medium';
                    break;
                case 'complaint':
                    suggestedPriority = 'high';
                    break;
                default:
                    suggestedPriority = 'low';
            }
            
            prioritySelect.value = suggestedPriority;
            this.highlightSuggestion(prioritySelect);
        }
    }

    highlightSuggestion(element) {
        element.style.backgroundColor = '#e3f2fd';
        setTimeout(() => {
            element.style.backgroundColor = '';
        }, 2000);
    }

    showSuccess(result) {
        this.form.style.display = 'none';
        const successMessage = document.getElementById('success-message');
        
        document.getElementById('ticket-id').textContent = result.ticketId;
        document.getElementById('response-time').textContent = 
            this.getResponseTime(result.priority);
        
        successMessage.style.display = 'block';
        successMessage.scrollIntoView({ behavior: 'smooth' });
    }

    getResponseTime(priority) {
        const responseTimes = {
            urgent: '2 小時',
            high: '4 小時',
            medium: '24 小時',
            low: '48 小時'
        };
        return responseTimes[priority] || '24 小時';
    }

    showError(message) {
        document.getElementById('error-text').textContent = message;
        document.getElementById('error-message').style.display = 'block';
    }

    showValidationErrors(errors) {
        const errorMessage = `請修正以下問題：\n${errors.join('\n')}`;
        alert(errorMessage);
    }

    setSubmittingState(isSubmitting) {
        this.isSubmitting = isSubmitting;
        const btnText = this.submitBtn.querySelector('.btn-text');
        const btnLoading = this.submitBtn.querySelector('.btn-loading');
        
        if (isSubmitting) {
            this.submitBtn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline';
        } else {
            this.submitBtn.disabled = false;
            btnText.style.display = 'inline';
            btnLoading.style.display = 'none';
        }
    }

    setupFormValidation() {
        // 即時驗證邏輯
        const inputs = this.form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('blur', () => this.validateField(input));
        });
    }

    validateField(field) {
        // 個別欄位驗證邏輯
        const value = field.value.trim();
        let isValid = true;
        let message = '';

        switch (field.name) {
            case 'customerEmail':
                if (value && !this.isValidEmail(value)) {
                    isValid = false;
                    message = '請輸入有效的電子郵件地址';
                }
                break;
            case 'description':
                if (value && value.length < 10) {
                    isValid = false;
                    message = '描述至少需要 10 個字元';
                }
                break;
        }

        this.updateFieldValidation(field, isValid, message);
    }

    updateFieldValidation(field, isValid, message) {
        const errorElement = field.parentNode.querySelector('.field-error');
        
        if (errorElement) {
            errorElement.remove();
        }

        if (!isValid) {
            field.style.borderColor = '#f44336';
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'field-error';
            errorDiv.textContent = message;
            field.parentNode.appendChild(errorDiv);
        } else {
            field.style.borderColor = '';
        }
    }

    isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// 全域函數
function resetForm() {
    document.getElementById('support-form').style.display = 'block';
    document.getElementById('success-message').style.display = 'none';
    document.getElementById('support-form').reset();
    window.scrollTo(0, 0);
}

function hideError() {
    document.getElementById('error-message').style.display = 'none';
}

// 初始化
document.addEventListener('DOMContentLoaded', () => {
    new SupportFormHandler();
});
```

### 🔧 後端 API 實作

```javascript
// api/support.js - 客服 API 後端
const express = require('express');
const multer = require('multer');
const path = require('path');
const { v4: uuidv4 } = require('uuid');

const MakeBridgeService = require('../services/MakeBridgeService');
const TicketService = require('../services/TicketService');

const router = express.Router();

// 文件上傳配置
const upload = multer({
    storage: multer.diskStorage({
        destination: (req, file, cb) => {
            cb(null, 'uploads/support/');
        },
        filename: (req, file, cb) => {
            const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
            cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));
        }
    }),
    limits: {
        fileSize: 10 * 1024 * 1024 // 10MB
    },
    fileFilter: (req, file, cb) => {
        const allowedTypes = /jpeg|jpg|png|gif|pdf|doc|docx/;
        const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());
        const mimetype = allowedTypes.test(file.mimetype);
        
        if (mimetype && extname) {
            return cb(null, true);
        } else {
            cb(new Error('不支援的檔案格式'));
        }
    }
});

class SupportController {
    constructor() {
        this.makeBridgeService = new MakeBridgeService();
        this.ticketService = new TicketService();
    }

    /**
     * 提交支援請求
     */
    async submitSupportRequest(req, res) {
        try {
            const requestData = req.body;
            
            // 驗證請求資料
            const validation = this.validateSupportRequest(requestData);
            if (!validation.isValid) {
                return res.status(400).json({
                    error: '資料驗證失敗',
                    details: validation.errors
                });
            }

            // 生成票據 ID
            const ticketId = this.generateTicketId();
            
            // 智能分類和優先級判斷
            const analysis = await this.analyzeRequest(requestData);
            
            // 準備 Make Bridge 資料
            const bridgeData = {
                ...requestData,
                ticketId,
                autoCategory: analysis.category,
                autoPriority: analysis.priority,
                assignedAgent: analysis.assignedAgent,
                timestamp: new Date().toISOString(),
                analysisScore: analysis.confidence
            };

            // 提交到 Make Bridge
            const bridgeResult = await this.makeBridgeService.triggerWorkflow({
                templateId: process.env.SUPPORT_TEMPLATE_ID,
                data: bridgeData
            });

            // 本地記錄
            const ticket = await this.ticketService.createTicket({
                ticketId,
                ...requestData,
                ...analysis,
                makeBridgeExecutionId: bridgeResult.executionId,
                status: 'open'
            });

            // 回應客戶
            res.json({
                success: true,
                ticketId,
                priority: analysis.priority,
                estimatedResponseTime: this.getEstimatedResponseTime(analysis.priority),
                assignedTeam: analysis.team
            });

        } catch (error) {
            console.error('提交支援請求失敗:', error);
            res.status(500).json({
                error: '提交失敗',
                message: '無法處理您的支援請求，請稍後再試'
            });
        }
    }

    /**
     * 上傳附件
     */
    async uploadAttachment(req, res) {
        try {
            if (!req.file) {
                return res.status(400).json({ error: '沒有選擇檔案' });
            }

            const fileInfo = {
                originalName: req.file.originalname,
                filename: req.file.filename,
                size: req.file.size,
                mimetype: req.file.mimetype,
                url: `/uploads/support/${req.file.filename}`
            };

            res.json(fileInfo);

        } catch (error) {
            console.error('檔案上傳失敗:', error);
            res.status(500).json({ error: '檔案上傳失敗' });
        }
    }

    /**
     * 查詢票據狀態
     */
    async getTicketStatus(req, res) {
        try {
            const { ticketId } = req.params;
            
            const ticket = await this.ticketService.getTicket(ticketId);
            
            if (!ticket) {
                return res.status(404).json({ error: '票據不存在' });
            }

            res.json({
                ticketId: ticket.ticketId,
                status: ticket.status,
                priority: ticket.priority,
                assignedAgent: ticket.assignedAgent,
                createdAt: ticket.createdAt,
                updatedAt: ticket.updatedAt,
                responses: ticket.responses || []
            });

        } catch (error) {
            console.error('查詢票據失敗:', error);
            res.status(500).json({ error: '無法查詢票據狀態' });
        }
    }

    /**
     * 智能分析請求
     */
    async analyzeRequest(requestData) {
        const { subject, description, category, priority } = requestData;
        
        // 關鍵詞分析
        const keywords = this.extractKeywords(subject + ' ' + description);
        
        // 自動分類
        const autoCategory = this.categorizeRequest(keywords, category);
        
        // 優先級調整
        const autoPriority = this.adjustPriority(keywords, priority, autoCategory);
        
        // 分配客服人員
        const assignedAgent = await this.assignAgent(autoCategory, autoPriority);
        
        // 置信度計算
        const confidence = this.calculateConfidence(keywords, autoCategory, autoPriority);

        return {
            category: autoCategory,
            priority: autoPriority,
            assignedAgent: assignedAgent.name,
            team: assignedAgent.team,
            confidence,
            keywords
        };
    }

    extractKeywords(text) {
        const urgentKeywords = ['緊急', '無法使用', '當機', '錯誤', '故障', 'bug'];
        const billingKeywords = ['帳單', '付款', '費用', '退款', '發票'];
        const technicalKeywords = ['登入', '密碼', '設定', '功能', '操作'];
        
        const lowerText = text.toLowerCase();
        
        return {
            urgent: urgentKeywords.some(keyword => lowerText.includes(keyword)),
            billing: billingKeywords.some(keyword => lowerText.includes(keyword)),
            technical: technicalKeywords.some(keyword => lowerText.includes(keyword)),
            all: [urgentKeywords, billingKeywords, technicalKeywords]
                .flat()
                .filter(keyword => lowerText.includes(keyword))
        };
    }

    categorizeRequest(keywords, userCategory) {
        // 如果關鍵詞分析有明確結果，則覆蓋使用者選擇
        if (keywords.billing) return 'billing';
        if (keywords.technical) return 'technical';
        
        // 否則使用使用者選擇
        return userCategory || 'general';
    }

    adjustPriority(keywords, userPriority, category) {
        // 緊急關鍵詞自動提升優先級
        if (keywords.urgent) {
            return userPriority === 'urgent' ? 'urgent' : 'high';
        }
        
        // 根據類別調整
        if (category === 'technical' && userPriority === 'low') {
            return 'medium';
        }
        
        return userPriority;
    }

    async assignAgent(category, priority) {
        const agents = {
            technical: [
                { name: '技術支援 - 小李', team: '技術部', skills: ['technical'] },
                { name: '技術支援 - 小王', team: '技術部', skills: ['technical'] }
            ],
            billing: [
                { name: '帳務專員 - 小陳', team: '財務部', skills: ['billing'] },
                { name: '帳務專員 - 小林', team: '財務部', skills: ['billing'] }
            ],
            general: [
                { name: '客服專員 - 小張', team: '客服部', skills: ['general'] },
                { name: '客服專員 - 小劉', team: '客服部', skills: ['general'] }
            ]
        };

        const availableAgents = agents[category] || agents.general;
        
        // 簡化的負載平衡（實際應用可以查詢資料庫）
        const randomIndex = Math.floor(Math.random() * availableAgents.length);
        return availableAgents[randomIndex];
    }

    calculateConfidence(keywords, category, priority) {
        let confidence = 0.5; // 基礎置信度
        
        // 關鍵詞匹配增加置信度
        if (keywords.all.length > 0) {
            confidence += 0.2;
        }
        
        // 類別一致性
        if ((category === 'technical' && keywords.technical) ||
            (category === 'billing' && keywords.billing)) {
            confidence += 0.2;
        }
        
        // 優先級合理性
        if (keywords.urgent && priority === 'urgent') {
            confidence += 0.1;
        }
        
        return Math.min(confidence, 1.0);
    }

    validateSupportRequest(data) {
        const errors = [];
        
        if (!data.customerName?.trim()) {
            errors.push('客戶姓名是必填欄位');
        }
        
        if (!data.customerEmail?.trim()) {
            errors.push('客戶郵件是必填欄位');
        } else if (!this.isValidEmail(data.customerEmail)) {
            errors.push('客戶郵件格式不正確');
        }
        
        if (!data.subject?.trim()) {
            errors.push('問題標題是必填欄位');
        }
        
        if (!data.description?.trim()) {
            errors.push('問題描述是必填欄位');
        } else if (data.description.trim().length < 10) {
            errors.push('問題描述至少需要 10 個字元');
        }
        
        if (!['technical', 'billing', 'general', 'complaint'].includes(data.category)) {
            errors.push('無效的問題類別');
        }
        
        if (!['low', 'medium', 'high', 'urgent'].includes(data.priority)) {
            errors.push('無效的優先級');
        }

        return {
            isValid: errors.length === 0,
            errors
        };
    }

    generateTicketId() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substr(2, 5);
        return `TK-${timestamp}-${random}`.toUpperCase();
    }

    getEstimatedResponseTime(priority) {
        const responseTimes = {
            urgent: '2 小時內',
            high: '4 小時內',
            medium: '24 小時內',
            low: '48 小時內'
        };
        return responseTimes[priority] || '24 小時內';
    }

    isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
}

const controller = new SupportController();

// 路由定義
router.post('/submit', (req, res) => controller.submitSupportRequest(req, res));
router.post('/upload', upload.single('file'), (req, res) => controller.uploadAttachment(req, res));
router.get('/ticket/:ticketId', (req, res) => controller.getTicketStatus(req, res));

module.exports = router;
```

## 8.3 場景 2：電商庫存預警系統

### 📝 業務需求

建立智能庫存預警系統，當庫存低於設定值時：
1. 自動計算補貨需求和時間
2. 發送預警通知給採購團隊
3. 根據銷售趨勢調整預警閾值
4. 自動生成採購建議
5. 追蹤供應商交期和價格

### 🔄 Make Bridge 模板設計

```javascript
// 庫存預警工作流程
{
  "name": "智能庫存預警系統",
  "description": "監控庫存水位，自動預警並生成補貨建議",
  "triggers": [
    {
      "type": "schedule",
      "name": "定期庫存檢查",
      "config": {
        "interval": "every 2 hours",
        "timezone": "Asia/Taipei"
      }
    },
    {
      "type": "webhook", 
      "name": "庫存異動觸發",
      "config": {
        "expectedData": {
          "productId": "string",
          "currentStock": "number",
          "operation": "sale|purchase|adjustment",
          "quantity": "number"
        }
      }
    }
  ],
  "modules": [
    {
      "type": "http",
      "name": "取得庫存資料",
      "config": {
        "url": "{{inventoryApiUrl}}/api/inventory/current",
        "method": "GET",
        "headers": {
          "Authorization": "Bearer {{inventoryApiKey}}"
        }
      }
    },
    {
      "type": "data-transformer",
      "name": "庫存分析",
      "config": {
        "transformations": [
          {
            "field": "lowStockItems",
            "logic": "filterLowStock({{inventoryData}})"
          },
          {
            "field": "criticalItems", 
            "logic": "filterCriticalStock({{inventoryData}})"
          },
          {
            "field": "salesTrend",
            "logic": "analyzeSalesTrend({{productId}}, 30)"
          },
          {
            "field": "restockSuggestion",
            "logic": "calculateRestockQuantity({{currentStock}}, {{salesTrend}}, {{leadTime}})"
          }
        ]
      }
    },
    {
      "type": "router",
      "name": "預警級別路由",
      "routes": [
        {
          "condition": "{{criticalItems.length}} > 0",
          "path": "critical_alert"
        },
        {
          "condition": "{{lowStockItems.length}} > 0",
          "path": "low_stock_alert"
        },
        {
          "condition": "true",
          "path": "normal_monitoring"
        }
      ]
    },
    {
      "type": "google-sheets",
      "name": "更新庫存監控表",
      "config": {
        "operation": "update",
        "spreadsheetId": "{{monitoringSheetId}}",
        "range": "庫存監控!A:Z",
        "values": "{{inventoryReport}}"
      }
    },
    {
      "type": "slack",
      "name": "緊急庫存預警",
      "config": {
        "channel": "#inventory-alerts",
        "message": {
          "blocks": [
            {
              "type": "section",
              "text": {
                "type": "mrkdwn",
                "text": ":warning: *緊急庫存預警* :warning:"
              }
            },
            {
              "type": "section",
              "fields": [
                {
                  "type": "mrkdwn",
                  "text": "*急需補貨商品:*\n{{#each criticalItems}}• {{name}} (剩餘: {{currentStock}})\n{{/each}}"
                },
                {
                  "type": "mrkdwn",
                  "text": "*預計缺貨時間:*\n{{#each criticalItems}}• {{name}}: {{stockoutDate}}\n{{/each}}"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "type": "airtable",
      "name": "建立採購需求",
      "config": {
        "operation": "create",
        "table": "Purchase Requests",
        "fields": {
          "Product ID": "{{productId}}",
          "Product Name": "{{productName}}",
          "Current Stock": "{{currentStock}}",
          "Suggested Quantity": "{{restockSuggestion.quantity}}",
          "Estimated Cost": "{{restockSuggestion.cost}}",
          "Preferred Supplier": "{{restockSuggestion.supplier}}",
          "Priority": "{{priority}}",
          "Created At": "{{timestamp}}"
        }
      }
    }
  ]
}
```

### 💻 庫存監控儀表板

```javascript
// inventory-dashboard.js - 庫存監控儀表板
class InventoryDashboard {
    constructor() {
        this.inventoryData = [];
        this.alertRules = [];
        this.suppliers = [];
        
        this.initializeDashboard();
        this.setupRealTimeUpdates();
    }

    async initializeDashboard() {
        await this.loadInventoryData();
        await this.loadAlertRules();
        await this.loadSuppliers();
        
        this.renderDashboard();
        this.setupEventListeners();
    }

    async loadInventoryData() {
        try {
            const response = await fetch('/api/inventory/current');
            this.inventoryData = await response.json();
        } catch (error) {
            console.error('載入庫存資料失敗:', error);
        }
    }

    renderDashboard() {
        const dashboard = document.getElementById('inventory-dashboard');
        
        dashboard.innerHTML = `
            <div class="dashboard-header">
                <h1>📦 庫存監控中心</h1>
                <div class="dashboard-stats">
                    ${this.renderStatsCards()}
                </div>
            </div>
            
            <div class="dashboard-content">
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h2>庫存預警</h2>
                        ${this.renderAlerts()}
                    </div>
                    
                    <div class="dashboard-card">
                        <h2>補貨建議</h2>
                        ${this.renderRestockSuggestions()}
                    </div>
                    
                    <div class="dashboard-card">
                        <h2>銷售趨勢</h2>
                        ${this.renderSalesTrends()}
                    </div>
                    
                    <div class="dashboard-card">
                        <h2>供應商狀態</h2>
                        ${this.renderSupplierStatus()}
                    </div>
                </div>
            </div>
        `;
    }

    renderStatsCards() {
        const lowStockCount = this.inventoryData.filter(item => 
            item.currentStock <= item.lowStockThreshold).length;
        
        const outOfStockCount = this.inventoryData.filter(item => 
            item.currentStock <= 0).length;
        
        const totalValue = this.inventoryData.reduce((sum, item) => 
            sum + (item.currentStock * item.unitCost), 0);

        return `
            <div class="stat-card">
                <div class="stat-icon">📋</div>
                <div class="stat-content">
                    <div class="stat-value">${this.inventoryData.length}</div>
                    <div class="stat-label">總商品數</div>
                </div>
            </div>
            
            <div class="stat-card alert">
                <div class="stat-icon">⚠️</div>
                <div class="stat-content">
                    <div class="stat-value">${lowStockCount}</div>
                    <div class="stat-label">低庫存預警</div>
                </div>
            </div>
            
            <div class="stat-card critical">
                <div class="stat-icon">🚨</div>
                <div class="stat-content">
                    <div class="stat-value">${outOfStockCount}</div>
                    <div class="stat-label">缺貨商品</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">💰</div>
                <div class="stat-content">
                    <div class="stat-value">${this.formatCurrency(totalValue)}</div>
                    <div class="stat-label">庫存總值</div>
                </div>
            </div>
        `;
    }

    renderAlerts() {
        const alerts = this.generateAlerts();
        
        if (alerts.length === 0) {
            return '<p class="no-alerts">暫無庫存預警</p>';
        }

        return `
            <div class="alerts-list">
                ${alerts.map(alert => `
                    <div class="alert-item ${alert.severity}">
                        <div class="alert-icon">${alert.icon}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-description">${alert.description}</div>
                            <div class="alert-actions">
                                <button onclick="this.handleRestockNow('${alert.productId}')" 
                                        class="btn btn-sm btn-primary">
                                    立即補貨
                                </button>
                                <button onclick="this.handleAdjustThreshold('${alert.productId}')" 
                                        class="btn btn-sm btn-secondary">
                                    調整閾值
                                </button>
                            </div>
                        </div>
                        <div class="alert-timestamp">${alert.timestamp}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }

    generateAlerts() {
        const alerts = [];
        
        this.inventoryData.forEach(item => {
            // 缺貨警報
            if (item.currentStock <= 0) {
                alerts.push({
                    productId: item.productId,
                    severity: 'critical',
                    icon: '🚨',
                    title: `${item.productName} 已缺貨`,
                    description: `當前庫存: ${item.currentStock}，急需補貨`,
                    timestamp: this.getTimeAgo(item.lastUpdated)
                });
            }
            // 低庫存警報
            else if (item.currentStock <= item.lowStockThreshold) {
                const daysUntilStockout = this.calculateDaysUntilStockout(item);
                alerts.push({
                    productId: item.productId,
                    severity: 'warning',
                    icon: '⚠️',
                    title: `${item.productName} 庫存偏低`,
                    description: `當前庫存: ${item.currentStock}，預計 ${daysUntilStockout} 天後缺貨`,
                    timestamp: this.getTimeAgo(item.lastUpdated)
                });
            }
        });

        return alerts.sort((a, b) => {
            const severityOrder = { critical: 0, warning: 1, info: 2 };
            return severityOrder[a.severity] - severityOrder[b.severity];
        });
    }

    calculateDaysUntilStockout(item) {
        // 根據歷史銷售資料計算預計缺貨時間
        const dailySalesRate = item.averageDailySales || 1;
        return Math.floor(item.currentStock / dailySalesRate);
    }

    async handleRestockNow(productId) {
        try {
            const product = this.inventoryData.find(item => item.productId === productId);
            
            // 計算建議補貨量
            const suggestion = await this.calculateRestockSuggestion(product);
            
            // 顯示補貨對話框
            this.showRestockDialog(product, suggestion);
            
        } catch (error) {
            console.error('處理補貨請求失敗:', error);
            alert('無法處理補貨請求，請稍後再試');
        }
    }

    async calculateRestockSuggestion(product) {
        // 分析銷售趨勢
        const salesHistory = await this.getSalesHistory(product.productId, 30);
        
        // 計算平均日銷量
        const averageDailySales = salesHistory.reduce((sum, day) => sum + day.quantity, 0) / 30;
        
        // 考慮供應商交期
        const leadTime = product.supplier?.leadTimeDays || 7;
        
        // 安全庫存係數
        const safetyFactor = 1.5;
        
        // 建議補貨量 = (日銷量 × 交期 × 安全係數) + 目標庫存 - 當前庫存
        const suggestedQuantity = Math.ceil(
            (averageDailySales * leadTime * safetyFactor) + 
            product.optimalStock - 
            product.currentStock
        );

        return {
            quantity: Math.max(suggestedQuantity, product.minimumOrderQuantity || 1),
            estimatedCost: suggestedQuantity * product.unitCost,
            supplier: product.supplier,
            expectedDelivery: this.addDays(new Date(), leadTime),
            reasoning: {
                averageDailySales,
                leadTime,
                safetyFactor,
                currentStock: product.currentStock,
                targetStock: product.optimalStock
            }
        };
    }

    showRestockDialog(product, suggestion) {
        const dialog = document.createElement('div');
        dialog.className = 'restock-dialog-overlay';
        dialog.innerHTML = `
            <div class="restock-dialog">
                <div class="dialog-header">
                    <h3>補貨建議 - ${product.productName}</h3>
                    <button class="close-btn" onclick="this.closeRestockDialog()">&times;</button>
                </div>
                
                <div class="dialog-content">
                    <div class="product-info">
                        <p><strong>當前庫存:</strong> ${product.currentStock}</p>
                        <p><strong>目標庫存:</strong> ${product.optimalStock}</p>
                        <p><strong>平均日銷:</strong> ${suggestion.reasoning.averageDailySales.toFixed(1)}</p>
                    </div>
                    
                    <div class="suggestion-info">
                        <p><strong>建議補貨量:</strong> ${suggestion.quantity}</p>
                        <p><strong>預估成本:</strong> ${this.formatCurrency(suggestion.estimatedCost)}</p>
                        <p><strong>供應商:</strong> ${suggestion.supplier?.name || '未指定'}</p>
                        <p><strong>預計到貨:</strong> ${this.formatDate(suggestion.expectedDelivery)}</p>
                    </div>
                    
                    <div class="custom-quantity">
                        <label for="customQuantity">自訂補貨量:</label>
                        <input type="number" id="customQuantity" value="${suggestion.quantity}" min="1">
                    </div>
                </div>
                
                <div class="dialog-actions">
                    <button class="btn btn-secondary" onclick="this.closeRestockDialog()">
                        取消
                    </button>
                    <button class="btn btn-primary" onclick="this.submitRestockRequest('${product.productId}')">
                        提交補貨請求
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(dialog);
    }

    async submitRestockRequest(productId) {
        try {
            const quantity = document.getElementById('customQuantity').value;
            
            const requestData = {
                productId,
                quantity: parseInt(quantity),
                reason: 'low_stock_alert',
                requestedBy: 'inventory_system',
                timestamp: new Date().toISOString()
            };

            // 提交到 Make Bridge
            const response = await fetch('/api/inventory/restock-request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            });

            if (response.ok) {
                alert('補貨請求已提交');
                this.closeRestockDialog();
                this.refreshDashboard();
            } else {
                throw new Error('提交失敗');
            }

        } catch (error) {
            console.error('提交補貨請求失敗:', error);
            alert('提交失敗，請稍後再試');
        }
    }

    closeRestockDialog() {
        const dialog = document.querySelector('.restock-dialog-overlay');
        if (dialog) {
            dialog.remove();
        }
    }

    setupRealTimeUpdates() {
        // 使用 WebSocket 或 Server-Sent Events 進行即時更新
        if ('WebSocket' in window) {
            this.connectWebSocket();
        } else {
            // 回退到定期輪詢
            setInterval(() => this.refreshDashboard(), 30000);
        }
    }

    connectWebSocket() {
        const ws = new WebSocket(`ws://${window.location.host}/ws/inventory`);
        
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.handleRealTimeUpdate(data);
        };
        
        ws.onclose = () => {
            console.log('WebSocket 連接關閉，5秒後重新連接');
            setTimeout(() => this.connectWebSocket(), 5000);
        };
    }

    handleRealTimeUpdate(data) {
        switch (data.type) {
            case 'inventory_update':
                this.updateInventoryItem(data.productId, data.newStock);
                break;
            case 'new_alert':
                this.addNewAlert(data.alert);
                break;
            case 'restock_completed':
                this.handleRestockCompleted(data.productId, data.quantity);
                break;
        }
    }

    updateInventoryItem(productId, newStock) {
        const item = this.inventoryData.find(item => item.productId === productId);
        if (item) {
            item.currentStock = newStock;
            item.lastUpdated = new Date().toISOString();
            this.renderDashboard();
        }
    }

    // 工具函數
    formatCurrency(amount) {
        return new Intl.NumberFormat('zh-TW', {
            style: 'currency',
            currency: 'TWD'
        }).format(amount);
    }

    formatDate(date) {
        return new Intl.DateTimeFormat('zh-TW').format(new Date(date));
    }

    getTimeAgo(timestamp) {
        const now = new Date();
        const past = new Date(timestamp);
        const diffInMinutes = Math.floor((now - past) / 60000);
        
        if (diffInMinutes < 60) {
            return `${diffInMinutes} 分鐘前`;
        } else if (diffInMinutes < 1440) {
            return `${Math.floor(diffInMinutes / 60)} 小時前`;
        } else {
            return `${Math.floor(diffInMinutes / 1440)} 天前`;
        }
    }

    addDays(date, days) {
        const result = new Date(date);
        result.setDate(result.getDate() + days);
        return result;
    }
}

// 初始化儀表板
document.addEventListener('DOMContentLoaded', () => {
    new InventoryDashboard();
});
```

## 8.4 場景 3：員工入職自動化流程

### 📝 業務需求

建立完整的新員工入職自動化系統：
1. 自動建立各系統帳戶和權限
2. 安排入職訓練課程和會議
3. 準備辦公設備和工作空間
4. 發送歡迎郵件和入職指南
5. 追蹤入職進度和完成狀況

### 🔄 Make Bridge 模板設計

```javascript
// 員工入職自動化流程
{
  "name": "新員工入職自動化",
  "description": "自動化新員工入職流程，從帳戶創建到培訓安排",
  "modules": [
    {
      "type": "webhook",
      "name": "新員工資料接收",
      "config": {
        "expectedData": {
          "employeeId": "string",
          "fullName": "string",
          "email": "string",
          "department": "string",
          "position": "string",
          "manager": "string",
          "startDate": "date",
          "employmentType": "full-time|part-time|contract",
          "location": "string"
        }
      }
    },
    {
      "type": "data-transformer",
      "name": "入職資料處理",
      "config": {
        "transformations": [
          {
            "field": "username",
            "logic": "generateUsername({{fullName}}, {{employeeId}})"
          },
          {
            "field": "temporaryPassword",
            "logic": "generateSecurePassword()"
          },
          {
            "field": "requiredSystems",
            "logic": "getSystemsByDepartment({{department}}, {{position}})"
          },
          {
            "field": "trainingModules",
            "logic": "getRequiredTraining({{department}}, {{position}})"
          },
          {
            "field": "equipmentNeeds",
            "logic": "getEquipmentList({{position}}, {{location}})"
          }
        ]
      }
    },
    {
      "type": "parallel",
      "name": "並行處理入職任務",
      "branches": [
        {
          "name": "系統帳戶創建",
          "modules": [
            {
              "type": "http",
              "name": "創建 AD 帳戶",
              "config": {
                "url": "{{adApiUrl}}/api/users",
                "method": "POST",
                "body": {
                  "username": "{{username}}",
                  "fullName": "{{fullName}}",
                  "email": "{{email}}",
                  "department": "{{department}}",
                  "temporaryPassword": "{{temporaryPassword}}"
                }
              }
            },
            {
              "type": "http",
              "name": "創建 Google Workspace 帳戶",
              "config": {
                "url": "{{googleApiUrl}}/admin/directory/v1/users",
                "method": "POST",
                "headers": {
                  "Authorization": "Bearer {{googleAccessToken}}"
                },
                "body": {
                  "primaryEmail": "{{email}}",
                  "name": {
                    "fullName": "{{fullName}}"
                  },
                  "password": "{{temporaryPassword}}",
                  "orgUnitPath": "/{{department}}"
                }
              }
            },
            {
              "type": "http",
              "name": "分配系統權限",
              "config": {
                "url": "{{permissionApiUrl}}/api/permissions/assign",
                "method": "POST",
                "body": {
                  "userId": "{{username}}",
                  "systems": "{{requiredSystems}}",
                  "department": "{{department}}",
                  "position": "{{position}}"
                }
              }
            }
          ]
        },
        {
          "name": "設備和空間準備",
          "modules": [
            {
              "type": "airtable",
              "name": "建立設備請求",
              "config": {
                "operation": "create",
                "table": "Equipment Requests",
                "fields": {
                  "Employee ID": "{{employeeId}}",
                  "Employee Name": "{{fullName}}",
                  "Department": "{{department}}",
                  "Equipment List": "{{equipmentNeeds}}",
                  "Location": "{{location}}",
                  "Required Date": "{{startDate}}",
                  "Status": "Pending"
                }
              }
            },
            {
              "type": "http",
              "name": "分配辦公座位",
              "config": {
                "url": "{{facilityApiUrl}}/api/seating/assign",
                "method": "POST",
                "body": {
                  "employeeId": "{{employeeId}}",
                  "department": "{{department}}",
                  "location": "{{location}}",
                  "startDate": "{{startDate}}"
                }
              }
            }
          ]
        },
        {
          "name": "培訓安排",
          "modules": [
            {
              "type": "http",
              "name": "註冊培訓課程",
              "config": {
                "url": "{{lmsApiUrl}}/api/enrollments",
                "method": "POST",
                "body": {
                  "employeeId": "{{employeeId}}",
                  "courses": "{{trainingModules}}",
                  "startDate": "{{startDate}}"
                }
              }
            },
            {
              "type": "google-calendar",
              "name": "安排入職會議",
              "config": {
                "operation": "create",
                "calendarId": "{{hrCalendarId}}",
                "event": {
                  "summary": "新員工入職會議 - {{fullName}}",
                  "description": "歡迎新同事 {{fullName}} 加入 {{department}}",
                  "start": {
                    "dateTime": "{{startDate}}T09:00:00",
                    "timeZone": "Asia/Taipei"
                  },
                  "end": {
                    "dateTime": "{{startDate}}T10:00:00",
                    "timeZone": "Asia/Taipei"
                  },
                  "attendees": [
                    {"email": "{{email}}"},
                    {"email": "{{manager}}"},
                    {"email": "hr@company.com"}
                  ]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "type": "delay",
      "name": "等待並行任務完成",
      "config": {
        "delay": 30,
        "unit": "seconds"
      }
    },
    {
      "type": "gmail",
      "name": "發送歡迎郵件",
      "config": {
        "to": "{{email}}",
        "cc": "{{manager}}, hr@company.com",
        "subject": "歡迎加入公司！您的入職資訊 - {{fullName}}",
        "template": "welcome_email",
        "templateData": {
          "fullName": "{{fullName}}",
          "department": "{{department}}",
          "position": "{{position}}",
          "manager": "{{manager}}",
          "startDate": "{{startDate}}",
          "username": "{{username}}",
          "temporaryPassword": "{{temporaryPassword}}",
          "trainingModules": "{{trainingModules}}",
          "firstDaySchedule": "{{firstDaySchedule}}"
        }
      }
    },
    {
      "type": "slack",
      "name": "通知團隊",
      "config": {
        "channel": "#general",
        "message": {
          "blocks": [
            {
              "type": "section",
              "text": {
                "type": "mrkdwn",
                "text": ":wave: 歡迎新同事 *{{fullName}}* 加入我們！"
              }
            },
            {
              "type": "section",
              "fields": [
                {
                  "type": "mrkdwn",
                  "text": "*部門:* {{department}}"
                },
                {
                  "type": "mrkdwn", 
                  "text": "*職位:* {{position}}"
                },
                {
                  "type": "mrkdwn",
                  "text": "*開始日期:* {{startDate}}"
                },
                {
                  "type": "mrkdwn",
                  "text": "*主管:* {{manager}}"
                }
              ]
            }
          ]
        }
      }
    },
    {
      "type": "airtable",
      "name": "建立入職追蹤記錄",
      "config": {
        "operation": "create",
        "table": "Onboarding Tracker",
        "fields": {
          "Employee ID": "{{employeeId}}",
          "Full Name": "{{fullName}}",
          "Department": "{{department}}",
          "Start Date": "{{startDate}}",
          "Account Created": "Yes",
          "Equipment Requested": "Yes",
          "Training Enrolled": "Yes",
          "Welcome Email Sent": "Yes",
          "Status": "In Progress",
          "Created At": "{{timestamp}}"
        }
      }
    }
  ]
}
```

### 💻 HR 管理介面

```javascript
// hr-onboarding.js - HR 入職管理系統
class OnboardingManagement {
    constructor() {
        this.employees = [];
        this.templates = [];
        this.onboardingTasks = [];
        
        this.initializeSystem();
    }

    async initializeSystem() {
        await this.loadEmployees();
        await this.loadTemplates();
        await this.loadOnboardingTasks();
        
        this.renderInterface();
        this.setupEventListeners();
    }

    renderInterface() {
        const container = document.getElementById('onboarding-management');
        
        container.innerHTML = `
            <div class="onboarding-header">
                <h1>👋 員工入職管理</h1>
                <button class="btn btn-primary" onclick="this.showNewEmployeeForm()">
                    <i class="fas fa-plus"></i> 新增員工
                </button>
            </div>
            
            <div class="onboarding-tabs">
                <button class="tab-btn active" data-tab="dashboard">儀表板</button>
                <button class="tab-btn" data-tab="employees">員工列表</button>
                <button class="tab-btn" data-tab="tasks">任務追蹤</button>
                <button class="tab-btn" data-tab="templates">範本管理</button>
            </div>
            
            <div class="tab-content">
                <div id="dashboard-tab" class="tab-pane active">
                    ${this.renderDashboard()}
                </div>
                
                <div id="employees-tab" class="tab-pane">
                    ${this.renderEmployeesList()}
                </div>
                
                <div id="tasks-tab" class="tab-pane">
                    ${this.renderTasksTracker()}
                </div>
                
                <div id="templates-tab" class="tab-pane">
                    ${this.renderTemplatesManager()}
                </div>
            </div>
        `;
    }

    renderDashboard() {
        const today = new Date();
        const thisWeek = this.getThisWeekEmployees();
        const thisMonth = this.getThisMonthEmployees();
        const pending = this.getPendingTasks();

        return `
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">👥</div>
                    <div class="stat-content">
                        <div class="stat-value">${thisWeek.length}</div>
                        <div class="stat-label">本週入職</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">📅</div>
                    <div class="stat-content">
                        <div class="stat-value">${thisMonth.length}</div>
                        <div class="stat-label">本月入職</div>
                    </div>
                </div>
                
                <div class="stat-card alert">
                    <div class="stat-icon">⏳</div>
                    <div class="stat-content">
                        <div class="stat-value">${pending.length}</div>
                        <div class="stat-label">待完成任務</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">✅</div>
                    <div class="stat-content">
                        <div class="stat-value">${this.getCompletionRate()}%</div>
                        <div class="stat-label">完成率</div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-content">
                <div class="dashboard-section">
                    <h3>即將入職員工</h3>
                    ${this.renderUpcomingEmployees()}
                </div>
                
                <div class="dashboard-section">
                    <h3>待處理任務</h3>
                    ${this.renderPendingTasks()}
                </div>
            </div>
        `;
    }

    showNewEmployeeForm() {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-header">
                    <h3>新增員工</h3>
                    <button class="close-btn" onclick="this.closeModal()">&times;</button>
                </div>
                
                <form id="new-employee-form" class="modal-content">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="employeeId">員工編號 *</label>
                            <input type="text" id="employeeId" name="employeeId" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="fullName">姓名 *</label>
                            <input type="text" id="fullName" name="fullName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">公司郵件 *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="department">部門 *</label>
                            <select id="department" name="department" required>
                                <option value="">請選擇...</option>
                                <option value="engineering">技術部</option>
                                <option value="marketing">行銷部</option>
                                <option value="sales">業務部</option>
                                <option value="hr">人資部</option>
                                <option value="finance">財務部</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="position">職位 *</label>
                            <input type="text" id="position" name="position" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="manager">直屬主管郵件 *</label>
                            <input type="email" id="manager" name="manager" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="startDate">入職日期 *</label>
                            <input type="date" id="startDate" name="startDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="employmentType">聘用類型 *</label>
                            <select id="employmentType" name="employmentType" required>
                                <option value="full-time">正職</option>
                                <option value="part-time">兼職</option>
                                <option value="contract">約聘</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="location">工作地點 *</label>
                            <select id="location" name="location" required>
                                <option value="taipei">台北總部</option>
                                <option value="taichung">台中分公司</option>
                                <option value="kaohsiung">高雄分公司</option>
                                <option value="remote">遠端工作</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>特殊需求 (選填)</h4>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="needs" value="accessibility"> 無障礙設施</label>
                            <label><input type="checkbox" name="needs" value="mac"> Mac 電腦</label>
                            <label><input type="checkbox" name="needs" value="monitor"> 外接螢幕</label>
                            <label><input type="checkbox" name="needs" value="parking"> 停車位</label>
                        </div>
                    </div>
                </form>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="this.closeModal()">
                        取消
                    </button>
                    <button type="submit" form="new-employee-form" class="btn btn-primary">
                        開始入職流程
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // 設定表單提交處理
        document.getElementById('new-employee-form').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleNewEmployeeSubmit(e.target);
        });
    }

    async handleNewEmployeeSubmit(form) {
        try {
            const formData = new FormData(form);
            const employeeData = {};
            
            // 收集基本資料
            for (let [key, value] of formData.entries()) {
                if (key === 'needs') {
                    if (!employeeData.specialNeeds) employeeData.specialNeeds = [];
                    employeeData.specialNeeds.push(value);
                } else {
                    employeeData[key] = value;
                }
            }

            // 驗證資料
            if (!this.validateEmployeeData(employeeData)) {
                return;
            }

            // 顯示載入狀態
            this.showLoadingState();

            // 提交到 Make Bridge
            const result = await this.submitOnboardingRequest(employeeData);

            // 成功處理
            this.showSuccessMessage(result);
            this.closeModal();
            this.refreshEmployeesList();

        } catch (error) {
            console.error('提交入職流程失敗:', error);
            this.showErrorMessage(error.message);
        }
    }

    async submitOnboardingRequest(employeeData) {
        const response = await fetch('/api/onboarding/initiate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(employeeData)
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || '提交失敗');
        }

        return response.json();
    }

    validateEmployeeData(data) {
        const errors = [];
        
        if (!data.employeeId?.trim()) errors.push('員工編號為必填');
        if (!data.fullName?.trim()) errors.push('姓名為必填');
        if (!data.email?.trim()) errors.push('郵件為必填');
        if (!data.department) errors.push('部門為必填');
        if (!data.position?.trim()) errors.push('職位為必填');
        if (!data.manager?.trim()) errors.push('主管郵件為必填');
        if (!data.startDate) errors.push('入職日期為必填');

        // 檢查日期是否為未來日期
        if (data.startDate && new Date(data.startDate) < new Date()) {
            errors.push('入職日期不能是過去的日期');
        }

        // 檢查郵件格式
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (data.email && !emailRegex.test(data.email)) {
            errors.push('郵件格式不正確');
        }
        if (data.manager && !emailRegex.test(data.manager)) {
            errors.push('主管郵件格式不正確');
        }

        if (errors.length > 0) {
            alert('請修正以下問題：\n' + errors.join('\n'));
            return false;
        }

        return true;
    }

    renderTasksTracker() {
        return `
            <div class="tasks-tracker">
                <div class="tracker-filters">
                    <select id="employee-filter">
                        <option value="">所有員工</option>
                        ${this.employees.map(emp => 
                            `<option value="${emp.employeeId}">${emp.fullName}</option>`
                        ).join('')}
                    </select>
                    
                    <select id="status-filter">
                        <option value="">所有狀態</option>
                        <option value="pending">待處理</option>
                        <option value="in-progress">進行中</option>
                        <option value="completed">已完成</option>
                        <option value="overdue">逾期</option>
                    </select>
                </div>
                
                <div class="tasks-list">
                    ${this.renderTasksList()}
                </div>
            </div>
        `;
    }

    renderTasksList() {
        return this.onboardingTasks.map(task => `
            <div class="task-item ${task.status}">
                <div class="task-header">
                    <div class="task-employee">
                        <strong>${task.employeeName}</strong>
                        <span class="employee-id">(${task.employeeId})</span>
                    </div>
                    <div class="task-status">
                        <span class="status-badge ${task.status}">${this.getStatusText(task.status)}</span>
                    </div>
                </div>
                
                <div class="task-content">
                    <div class="task-title">${task.title}</div>
                    <div class="task-description">${task.description}</div>
                    
                    <div class="task-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${task.progress}%"></div>
                        </div>
                        <span class="progress-text">${task.progress}% 完成</span>
                    </div>
                    
                    <div class="task-dates">
                        <span>開始：${this.formatDate(task.startDate)}</span>
                        <span>預計完成：${this.formatDate(task.dueDate)}</span>
                    </div>
                </div>
                
                <div class="task-actions">
                    <button class="btn btn-sm btn-outline" onclick="this.viewTaskDetails('${task.id}')">
                        查看詳情
                    </button>
                    ${task.status === 'pending' ? 
                        `<button class="btn btn-sm btn-primary" onclick="this.startTask('${task.id}')">
                            開始處理
                        </button>` : ''
                    }
                    ${task.status === 'in-progress' ? 
                        `<button class="btn btn-sm btn-success" onclick="this.completeTask('${task.id}')">
                            標記完成
                        </button>` : ''
                    }
                </div>
            </div>
        `).join('');
    }

    // 工具函數
    getThisWeekEmployees() {
        const today = new Date();
        const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
        const weekEnd = new Date(today.setDate(today.getDate() - today.getDay() + 6));
        
        return this.employees.filter(emp => {
            const startDate = new Date(emp.startDate);
            return startDate >= weekStart && startDate <= weekEnd;
        });
    }

    getThisMonthEmployees() {
        const today = new Date();
        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
        const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        
        return this.employees.filter(emp => {
            const startDate = new Date(emp.startDate);
            return startDate >= monthStart && startDate <= monthEnd;
        });
    }

    getPendingTasks() {
        return this.onboardingTasks.filter(task => 
            task.status === 'pending' || task.status === 'overdue'
        );
    }

    getCompletionRate() {
        const total = this.onboardingTasks.length;
        const completed = this.onboardingTasks.filter(task => task.status === 'completed').length;
        return total > 0 ? Math.round((completed / total) * 100) : 0;
    }

    formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('zh-TW');
    }

    getStatusText(status) {
        const statusMap = {
            'pending': '待處理',
            'in-progress': '進行中',
            'completed': '已完成',
            'overdue': '逾期'
        };
        return statusMap[status] || status;
    }

    closeModal() {
        const modal = document.querySelector('.modal-overlay');
        if (modal) {
            modal.remove();
        }
    }

    showLoadingState() {
        // 實作載入狀態顯示
    }

    showSuccessMessage(result) {
        alert(`入職流程已啟動！\n追蹤編號：${result.trackingId}`);
    }

    showErrorMessage(message) {
        alert(`錯誤：${message}`);
    }
}

// 初始化系統
document.addEventListener('DOMContentLoaded', () => {
    new OnboardingManagement();
});
```

## 8.5 本章總結

本章提供了三個詳細的 Make Bridge 應用場景：

✅ **智能客服票據系統** - 完整的客戶支援自動化流程  
✅ **電商庫存預警系統** - 智能庫存監控和補貨建議  
✅ **員工入職自動化流程** - 新員工入職的端到端自動化  

### 📈 實作亮點

每個場景都展示了：
- **完整的業務流程自動化**
- **智能資料分析和決策邏輯**
- **多系統整合和並行處理**
- **用戶友善的管理介面**
- **即時監控和通知機制**

### 🚀 下一步

這些場景可作為您開發自己的 Make Bridge 解決方案的參考模板。您可以根據具體業務需求調整工作流程、修改介面設計，或整合其他系統和服務。

下一章將深入探討 Make API 的進階應用，為需要更高度客製化的場景提供技術指導。